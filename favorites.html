<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Favorites - ENHA-FLIX</title>
    <link rel="stylesheet" href="styles/styles.css">
</head>
<body>
    <div id="favorites-page" class="page active">
        <header class="main-header">
            <a href="engene.html" class="header-logo">ENHA-FLIX</a>
            <div class="header-actions">
                <button class="clear-favorites-btn" onclick="clearAllFavorites()">Clear All Favorites</button>
            </div>
        </header>

        <div class="favorites-container">
            <div class="favorites-header">
                <h1 class="favorites-title">My Favorites</h1>
                <p class="favorites-subtitle">Your cherished ENHYPEN moments</p>
            </div>

            <div class="favorites-controls">
                <div class="favorites-stats" id="favorites-stats">
                    <!-- Stats will be loaded here -->
                </div>
                <div class="favorites-filters">
                    <button class="filter-btn active" onclick="filterFavorites('all')">All</button>
                    <button class="filter-btn" onclick="filterFavorites('recent')">Recently Added</button>
                    <button class="filter-btn" onclick="filterFavorites('oldest')">Oldest</button>
                </div>
            </div>

            <div class="favorites-grid" id="favorites-grid">
                <!-- Favorite items will be loaded here -->
            </div>

            <div class="empty-favorites" id="empty-favorites">
                <div class="empty-icon">üíñ</div>
                <h2>No Favorites Yet</h2>
                <p>Your favorite ENHYPEN moments will appear here!</p>
                <p class="empty-hint">Click the ‚ô° heart on any content to add it to your favorites</p>
                <a href="engene.html" class="browse-btn">Start Exploring</a>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toast-message"></span>
    </div>

    <script>
        // ===== FAVORITES PAGE FUNCTIONALITY =====
        let currentFilter = 'all';

        function loadFavoritesPage() {
            updateFavoritesStats();
            displayFavorites();
        }

        function updateFavoritesStats() {
            const statsElement = document.getElementById('favorites-stats');
            const favorites = getFavorites();
            
            const total = favorites.length;
            
            // Calculate recently added (last 7 days)
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const recent = favorites.filter(item => new Date(item.addedAt) > weekAgo).length;
            
            // Calculate average per week
            if (favorites.length > 0) {
                const oldest = new Date(favorites[favorites.length - 1].addedAt);
                const weeksDiff = Math.max(1, Math.ceil((new Date() - oldest) / (7 * 24 * 60 * 60 * 1000)));
                const avgPerWeek = Math.ceil(total / weeksDiff);
            }

            statsElement.innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${total}</div>
                    <div class="stat-label">Total Favorites</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${recent}</div>
                    <div class="stat-label">Recent</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${total > 0 ? Math.ceil(total / Math.max(1, (favorites.length > 0 ? Math.ceil((new Date() - new Date(favorites[favorites.length - 1].addedAt)) / (7 * 24 * 60 * 60 * 1000)) : 1))) : 0}</div>
                    <div class="stat-label">Avg per Week</div>
                </div>
            `;
        }

        function displayFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const emptyFavorites = document.getElementById('empty-favorites');
            let favorites = getFavorites();
            
            // Apply filters
            if (currentFilter === 'recent') {
                favorites = [...favorites].sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
            } else if (currentFilter === 'oldest') {
                favorites = [...favorites].sort((a, b) => new Date(a.addedAt) - new Date(b.addedAt));
            }
            
            if (favorites.length === 0) {
                favoritesGrid.style.display = 'none';
                emptyFavorites.style.display = 'block';
                return;
            }
            
            favoritesGrid.style.display = 'grid';
            emptyFavorites.style.display = 'none';
            
            favoritesGrid.innerHTML = favorites.map(item => createFavoriteGridItem(item)).join('');
        }

        function createFavoriteGridItem(item) {
            const timeAgo = getTimeAgo(item.addedAt);
            const addedDate = new Date(item.addedAt).toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            return `
                <div class="favorite-grid-item" data-id="${item.id}">
                    <div class="favorite-grid-thumbnail" onclick="playFavorite('${item.id}')">
                        <img src="${item.thumbnail || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjE3MCIgdmlld0JveD0iMCAwIDMwMCAxNzAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMTcwIiBmaWxsPSIjMzMzIi8+CjxwYXRoIGQ9Ik0xMjAgODVMMTQwIDcwTDE2MCA4NUwxNDAgMTAwTDEyMCA4NVoiIGZpbGw9IiNlNTA5MTQiLz4KPC9zdmc+'}">
                        <div class="favorite-grid-heart heart-active" onclick="event.stopPropagation(); removeFavorite('${item.id}')">
                            ‚ù§Ô∏è
                        </div>
                        <div class="favorite-grid-actions">
                            <button class="grid-action play-action" onclick="event.stopPropagation(); playFavorite('${item.id}')">
                                ‚ñ∂ Play
                            </button>
                            <button class="grid-action remove-action" onclick="event.stopPropagation(); removeFavorite('${item.id}')">
                                üóëÔ∏è Remove
                            </button>
                        </div>
                    </div>
                    <div class="favorite-grid-info">
                        <div class="favorite-grid-title">${item.title}</div>
                        <div class="favorite-grid-meta">
                            <span class="added-date">${addedDate}</span>
                            <span class="added-ago">${timeAgo}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterFavorites(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            displayFavorites();
        }

        function clearAllFavorites() {
            const favorites = getFavorites();
            if (favorites.length === 0) {
                showToast('No favorites to clear');
                return;
            }
            
            if (confirm(`Are you sure you want to remove all ${favorites.length} favorites? This cannot be undone.`)) {
                localStorage.removeItem('enhaflix_favorites');
                loadFavoritesPage();
                showToast('Cleared all favorites');
            }
        }

        function removeFavorite(itemId) {
            const favorites = getFavorites();
            const filtered = favorites.filter(item => item.id !== itemId);
            localStorage.setItem('enhaflix_favorites', JSON.stringify(filtered));
            loadFavoritesPage();
            showToast('Removed from favorites');
        }

        function playFavorite(itemId) {
            const favorites = getFavorites();
            const item = favorites.find(f => f.id === itemId);
            
            if (item) {
                // Open the main page to use the video modal
                window.location.href = `engene.html?play=${encodeURIComponent(item.url)}&title=${encodeURIComponent(item.title)}&thumbnail=${encodeURIComponent(item.thumbnail || '')}`;
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ===== HELPER FUNCTIONS =====
        function getFavorites() {
            try {
                return JSON.parse(localStorage.getItem('enhaflix_favorites')) || [];
            } catch {
                return [];
            }
        }

        function getTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);
            
            if (diffMins < 1) return 'just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        // ===== INITIALIZE FAVORITES PAGE =====
        document.addEventListener('DOMContentLoaded', function() {
            loadFavoritesPage();
        });
    </script>
</body>
</html>